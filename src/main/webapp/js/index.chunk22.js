const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["index.chunk23.js","wallet.bundle.js","parseSignature.chunk.js","localBatchGatewayRequest.chunk.js","secp256k1.chunk.js","hashTypedData.chunk.js","index.chunk24.js","index.chunk25.js"])))=>i.map(i=>d[i]);
import{da as D,bq as v,aW as b,db as C,c1 as I,b2 as y,dc as A,dd as h,co as L}from"./wallet.bundle.js";import{de as T}from"./wallet.bundle.js";function k(u={}){let f,d,s,r;return D(o=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",async connect({chainId:t,withCapabilities:e}={}){try{const n=await this.getProvider(),i=(await n.request({method:"eth_requestAccounts",params:[]})).map(a=>v(a));d||(d=this.onAccountsChanged.bind(this),n.on("accountsChanged",d)),s||(s=this.onChainChanged.bind(this),n.on("chainChanged",s)),r||(r=this.onDisconnect.bind(this),n.on("disconnect",r));let c=await this.getChainId();if(t&&c!==t){const a=await this.switchChain({chainId:t}).catch(w=>{if(w.code===y.code)throw w;return{id:c}});c=(a==null?void 0:a.id)??c}return{accounts:e?i.map(a=>({address:a,capabilities:{}})):i,chainId:c}}catch(n){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(n.message)?new y(n):n}},async disconnect(){const t=await this.getProvider();d&&(t.removeListener("accountsChanged",d),d=void 0),s&&(t.removeListener("chainChanged",s),s=void 0),r&&(t.removeListener("disconnect",r),r=void 0),t.disconnect()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(e=>v(e))},async getChainId(){const e=await(await this.getProvider()).request({method:"eth_chainId"});return Number(e)},async getProvider(){if(!f){const t=(()=>{var i;return typeof u.preference=="string"?{options:u.preference}:{...u.preference,options:((i=u.preference)==null?void 0:i.options)??"all"}})(),{createBaseAccountSDK:e}=await A(async()=>{const{createBaseAccountSDK:i}=await import("./index.chunk23.js");return{createBaseAccountSDK:i}},__vite__mapDeps([0,1,2,3,4,5]));f=e({...u,appChainIds:o.chains.map(i=>i.id),preference:t}).getProvider()}return f},async isAuthorized(){try{return!!(await this.getAccounts()).length}catch{return!1}},async switchChain({addEthereumChainParameter:t,chainId:e}){var c,a,w,_;const n=o.chains.find(l=>l.id===e);if(!n)throw new b(new C);const i=await this.getProvider();try{return await i.request({method:"wallet_switchEthereumChain",params:[{chainId:I(n.id)}]}),n}catch(l){if(l.code===4902)try{let p;t!=null&&t.blockExplorerUrls?p=t.blockExplorerUrls:p=(c=n.blockExplorers)!=null&&c.default.url?[(a=n.blockExplorers)==null?void 0:a.default.url]:[];let g;(w=t==null?void 0:t.rpcUrls)!=null&&w.length?g=t.rpcUrls:g=[((_=n.rpcUrls.default)==null?void 0:_.http[0])??""];const q={blockExplorerUrls:p,chainId:I(e),chainName:(t==null?void 0:t.chainName)??n.name,iconUrls:t==null?void 0:t.iconUrls,nativeCurrency:(t==null?void 0:t.nativeCurrency)??n.nativeCurrency,rpcUrls:g};return await i.request({method:"wallet_addEthereumChain",params:[q]}),n}catch(p){throw new y(p)}throw new b(l)}},onAccountsChanged(t){t.length===0?this.onDisconnect():o.emitter.emit("change",{accounts:t.map(e=>v(e))})},onChainChanged(t){const e=Number(t);o.emitter.emit("change",{chainId:e})},async onDisconnect(t){o.emitter.emit("disconnect");const e=await this.getProvider();d&&(e.removeListener("accountsChanged",d),d=void 0),s&&(e.removeListener("chainChanged",s),s=void 0),r&&(e.removeListener("disconnect",r),r=void 0)}}))}S.type="safe";function S(u={}){const{shimDisconnect:f=!1}=u;let d,s;return D(r=>({id:"safe",name:"Safe",type:S.type,async connect({withCapabilities:o}={}){var i;const t=await this.getProvider();if(!t)throw new h;const e=await this.getAccounts(),n=await this.getChainId();return s||(s=this.onDisconnect.bind(this),t.on("disconnect",s)),f&&await((i=r.storage)==null?void 0:i.removeItem("safe.disconnected")),{accounts:o?e.map(c=>({address:c,capabilities:{}})):e,chainId:n}},async disconnect(){var t;const o=await this.getProvider();if(!o)throw new h;s&&(o.removeListener("disconnect",s),s=void 0),f&&await((t=r.storage)==null?void 0:t.setItem("safe.disconnected",!0))},async getAccounts(){const o=await this.getProvider();if(!o)throw new h;return(await o.request({method:"eth_accounts"})).map(v)},async getProvider(){if(typeof window<"u"&&(window==null?void 0:window.parent)!==window){if(!d){const{default:t}=await A(async()=>{const{default:c}=await import("./index.chunk24.js").then(a=>a.e);return{default:c}},__vite__mapDeps([6,1,5])),e=new t(u),n=await L(()=>e.safe.getInfo(),{timeout:u.unstable_getInfoTimeout??10});if(!n)throw new Error("Could not load Safe information");const i=await(async()=>{const c=await A(()=>import("./index.chunk25.js").then(a=>a.i),__vite__mapDeps([7,1,6,5]));return typeof c.SafeAppProvider!="function"&&typeof c.default.SafeAppProvider=="function"?c.default.SafeAppProvider:c.SafeAppProvider})();d=new i(n,e)}return d}},async getChainId(){const o=await this.getProvider();if(!o)throw new h;return Number(o.chainId)},async isAuthorized(){var o;try{return f&&await((o=r.storage)==null?void 0:o.getItem("safe.disconnected"))?!1:!!(await this.getAccounts()).length}catch{return!1}},onAccountsChanged(){},onChainChanged(){},onDisconnect(){r.emitter.emit("disconnect")}}))}export{k as baseAccount,T as injected,S as safe};
